<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AnonMarket</title>
<link rel="icon" href="https://files.catbox.moe/3xstci.png">
<style>
body{margin:0;font-family:Arial,sans-serif;background:#fff;}
header{background:#b00000;color:#fff;padding:12px 15px;display:flex;justify-content:space-between;align-items:center;}
header .left{display:flex;align-items:center;gap:10px;}
header img{width:35px;}
.menu{font-size:26px;cursor:pointer;}
main{padding:20px;}
.btn{background:#b00000;color:#fff;border:none;padding:10px 18px;cursor:pointer;border-radius:4px;margin:4px 0;}
.btn.disabled{background:#888;cursor:not-allowed;}
.product{border:1px solid #ddd;padding:15px;margin-bottom:15px;border-radius:6px;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:999;}
.modal-box{background:#fff;padding:20px;width:90%;max-width:400px;border-radius:6px;}
input,textarea{width:100%;padding:10px;margin:6px 0;}
footer{background:#eee;text-align:center;padding:20px;margin-top:40px;}
footer img{width:40px;margin:0 8px;}
</style>
</head>
<body>

<header>
  <div class="left">
    <img src="https://files.catbox.moe/3xstci.png">
    <b>AnonMarket Shop</b>
  </div>
  <div class="menu" onclick="openReport()">⋮</div>
</header>

<main id="main-content">
<h2>Login / Register</h2>
<div id="auth">
<input id="name" placeholder="Nama (untuk register)">
<input id="email" placeholder="Email">
<input id="password" placeholder="Password" type="password">
<button class="btn" onclick="register()">Register</button>
<button class="btn" onclick="login()">Login</button>
</div>
</main>

<div id="products" style="display:none;margin-top:20px"></div>

<div class="modal" id="report">
<div class="modal-box">
<h3>Laporan Masalah</h3>
<textarea id="repText" placeholder="Isi laporan"></textarea>
<input id="repWA" placeholder="Nomor WhatsApp">
<input type="file">
<button class="btn" onclick="sendReport()">Kirim</button>
<button class="btn" onclick="closeModal('report')">Tutup</button>
</div>
</div>

<footer>
<p>KAMI DISINI SELALU AMANAH JIKA ADA PENIPUAN ATAU PENIRUAN WEBSITE KAMI SILAHKAN LAPOR KE CS DI BAWAH:</p>
<a href="https://t.me/anondevworm"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png"></a>
<a href="https://wa.me/60175953518"><img src="https://cdn-icons-png.flaticon.com/512/733/733585.png"></a>
<p>© AlwaysAno 2025 | Privacy & Policy</p>
</footer>

<script>
let currentUser = null;

const products = [
  {name:"Sewa Bot Jaga Grup WhatsApp 1 Bulan", price:6000, slug:"sewa-bot-whatsapp-anon", maintance:true},
  {name:"Panel Ptredoctuly Unlimited", price:7000, slug:"", maintance:true},
  {name:"Nokos Brazil", price:30000, slug:""}  
];

function showProducts(){
  const container = document.getElementById("products");
  container.innerHTML = "";
  products.forEach(p=>{
    let btn = `<button class="btn${p.maintance ? " disabled" : ""}" ${p.maintance ? `onclick="alert('System: Produk Sedang Maintance')"` : `onclick="payProduct('${p.slug}', ${p.price}, '${p.name}')"`}>Beli</button>`;
    container.innerHTML += `<div class="product"><h3>${p.name}</h3><p>Price: ${p.price}</p>${btn}</div>`;
  });
  container.style.display="block";
}

function openModal(id){ document.getElementById(id).style.display="flex"; }
function closeModal(id){ document.getElementById(id).style.display="none"; }
function openReport(){ openModal('report'); }

async function register(){
    const name=document.getElementById("name").value;
    const email=document.getElementById("email").value;
    const password=document.getElementById("password").value;
    const res = await fetch('/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,email,password})});
    const data=await res.json();
    if(data.error) alert(data.error); else {currentUser=data; showDashboard();}
}

async function login(){
    const email=document.getElementById("email").value;
    const password=document.getElementById("password").value;
    const res = await fetch('/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});
    const data=await res.json();
    if(data.error) alert(data.error); else {currentUser=data; showDashboard();}
}

async function showDashboard(){
    document.getElementById('main-content').innerHTML=`<h2>Halo, ${currentUser.name}</h2>
    <button class="btn" onclick="showProducts()">Lihat Produk</button>
    <h3>Dashboard Merchant</h3><div id="dashboard"></div>`;
    updateDashboard();
}

async function updateDashboard(){
    const res = await fetch(`/dashboard/${currentUser.user_id}`);
    const orders = await res.json();
    let html="<ul>";
    orders.forEach(o=>{html+=`<li>${o.detail} - ${o.amount} - ${o.status} - ${o.created_at}</li>`;});
    html+="</ul>";
    document.getElementById("dashboard").innerHTML=html;
}

async function payProduct(slug, amount, productName){
    if(!slug){ alert("Slug produk belum diisi"); return; }
    let order_id = productName.replace(/\s+/g,'')+"-"+Date.now();
    let detail = productName;
    const res = await fetch('/create-payment',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({order_id,amount,detail,user_id:currentUser.user_id,slug})
    });
    const data = await res.json();
    if(data.url) window.open(data.url,'_blank');
    updateDashboard();
}

function sendReport(){ alert("Laporan terkirim, CS akan menghubungi."); closeModal("report"); }
</script>

</body>
  </html>
